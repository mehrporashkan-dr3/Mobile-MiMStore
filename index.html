<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>فرم درخواست خرید اقساطی – میم استور</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    .container {
      max-width: 720px;
      margin: 0 auto;
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: .75rem;
      font-size: 1.1rem;
    }
    h3 {
      margin-top: 1.75rem;
      border-right: 3px solid #c00;
      padding-right: .5rem;
      font-size: 1rem;
    }
    p, label {
      font-size: .9rem;
    }
    input, select, textarea, button {
      font-family: inherit;
      font-size: .9rem;
      line-height: 1.4;
    }
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      box-sizing: border-box;
      padding: .45rem .55rem;
      margin-bottom: .5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      outline: none;
    }
    input:focus,
    textarea:focus,
    select:focus {
      border-color: #c00;
      box-shadow: 0 0 0 2px rgba(204,0,0,0.12);
    }
    textarea {
      resize: vertical;
      min-height: 70px;
    }
    .terms-box {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: .75rem;
      font-size: .85rem;
      line-height: 1.9;
      text-align: justify;
      background: #fafafa;
    }
    .checkbox-row {
      display: block;
      margin-bottom: .5rem;
      font-size: .85rem;
      line-height: 1.7;
    }
    .checkbox-row input {
      margin-left: .4rem;
    }

    /* امضاء */
    .signature-panel {
      border: 1px dashed #bdbdbd;
      border-radius: 8px;
      padding: .75rem;
      margin-top: .75rem;
      background: #fff;
      font-size: .85rem;
      line-height: 1.8;
    }
    .signature-canvas {
      width: 100%;
      height: 160px;
      border: 1px solid #bbb;
      border-radius: 6px;
      background: #fff;
      touch-action: none;
    }
    .signature-actions {
      margin-top: .35rem;
      text-align: left;
      font-size: .8rem;
    }
    .signature-actions button {
      padding: .3rem .7rem;
      border-radius: 6px;
      border: none;
      background: #f44336;
      color: #fff;
      cursor: pointer;
    }
    .signature-actions button:hover {
      background: #d32f2f;
    }
    .signature-name-line {
      margin-top: .6rem;
      font-size: .85rem;
    }

    .buttons {
      display: flex;
      flex-direction: column;
      gap: .5rem;
      margin-top: 1rem;
    }
    .btn-main,
    .btn-secondary {
      width: 100%;
      padding: .75rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      cursor: pointer;
    }
    .btn-main {
      background: #d32f2f;
      color: #fff;
    }
    .btn-main:hover {
      background: #b71c1c;
    }
    .btn-secondary {
      background: #333;
      color: #fff;
    }
    .btn-secondary:hover {
      background: #111;
    }

    .hint-text {
      margin-top: .6rem;
      font-size: .78rem;
      color: #555;
      text-align: justify;
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="mimstore-credit-form">
      <h2>فرم درخواست خرید اقساطی – میم استور</h2>

      <p style="text-align:justify; line-height:1.7;">
        لطفاً این فرم را تنها توسط متقاضی اصلی خرید اقساطی تکمیل کنید. تمامی اطلاعات، از جمله چک و مدارک اعتباری،
        باید به نام همان متقاضی (دارنده دسته‌چک) باشد. در صورت مغایرت، بررسی درخواست انجام نخواهد شد.
      </p>

      <!-- ۱. اطلاعات هویتی متقاضی -->
      <h3>۱. اطلاعات هویتی متقاضی</h3>

      <label>نام و نام خانوادگی</label>
      <input type="text" name="full_name" id="full-name" required placeholder="مثال: علی رضایی">

      <label>نام پدر</label>
      <input type="text" name="father_name" required placeholder="مثال: حسن">

      <label>کد ملی</label>
      <input type="text" name="national_id" required minlength="10" maxlength="10" placeholder="۱۰ رقم">

      <label>شماره شناسنامه</label>
      <input type="text" name="id_number" required>

      <label>محل صدور شناسنامه</label>
      <input type="text" name="id_place" required placeholder="مثال: تهران">

      <label>تاریخ تولد (شمسی)</label>
      <input type="text" name="birth_date" required placeholder="مثال: 1378/05/21">

      <label>وضعیت تأهل</label>
      <select name="marital_status" required>
        <option value="">انتخاب کنید</option>
        <option value="مجرد">مجرد</option>
        <option value="متأهل">متأهل</option>
      </select>

      <label>میزان تحصیلات</label>
      <select name="education" required>
        <option value="">انتخاب کنید</option>
        <option value="دیپلم">دیپلم</option>
        <option value="کاردانی">کاردانی</option>
        <option value="کارشناسی">کارشناسی</option>
        <option value="کارشناسی ارشد">کارشناسی ارشد</option>
        <option value="دکتری">دکتری</option>
      </select>

      <label>شماره موبایل به نام خودتان</label>
      <input type="tel" name="mobile" required placeholder="مثال: 09XXXXXXXXX">

      <!-- ۲. اطلاعات محل سکونت -->
      <h3>۲. اطلاعات محل سکونت</h3>

      <label>نشانی کامل محل سکونت</label>
      <textarea name="address" required placeholder="شهر، خیابان، کوچه، پلاک، واحد"></textarea>

      <label>کد پستی</label>
      <input type="text" name="postal_code" required minlength="10" maxlength="10">

      <!-- ۳. اطلاعات شغلی -->
      <h3>۳. اطلاعات شغلی</h3>

      <label>شغل / عنوان شغلی</label>
      <input type="text" name="job_title" required placeholder="مثال: فروشنده موبایل">

      <label>سابقه کار (چند سال)</label>
      <input type="number" name="job_years" min="0" required placeholder="مثال: ۳">

      <!-- ۴. اطلاعات اعتبار درخواستی -->
      <h3>۴. اطلاعات اعتبار درخواستی</h3>

      <p style="margin-bottom:.4rem;">سقف اعتبار درخواستی</p>
      <label class="checkbox-row">
        <input type="radio" name="credit_cap" value="۵۰ میلیون تومان" required>
        ۵۰ میلیون تومان
      </label>
      <label class="checkbox-row" style="margin-bottom:.6rem;">
        <input type="radio" name="credit_cap" value="۱۰۰ میلیون تومان (آیفون ۱۶ و ۱۷)">
        ۱۰۰ میلیون تومان (فقط برای خرید آیفون ۱۶ و ۱۷)
      </label>

      <label>اعتبار مورد نیاز (در صورت کمتر بودن)</label>
      <input type="text" id="credit-needed" name="credit_needed" placeholder="مثال: 30,000,000">

      <label>مدل کالا / توضیحات خرید</label>
      <input type="text" name="product_model" placeholder="مثال: iPhone 13 ، Samsung S24">

      <label>توضیحات تکمیلی (اختیاری)</label>
      <textarea name="extra_note" placeholder="هر توضیحی لازم است بنویسید"></textarea>

      <!-- ۵. مدارک -->
      <h3>۵. مدارک</h3>

      <p style="font-size:.9rem; line-height:1.7; text-align:justify;">
        پس از ارسال این فرم، <strong>ارسال تصویر واضح روی کارت ملی از طریق واتساپ به شماره میم‌استور الزامی است.</strong><br>
        بدون دریافت تصویر کارت ملی، امکان ادامه روند اعتبارسنجی وجود نخواهد داشت.
      </p>

      <!-- ۶. شرایط + تیک‌ها + امضاء (بخشی که PNG می‌شود) -->
      <h3>۶. شرایط و مقررات و تأیید متقاضی</h3>

      <div id="confirm-section">
        <div class="terms-box">
          1. این فرم صرفاً جهت <strong>بررسی اولیه اعتبار</strong> می‌باشد و به‌تنهایی به‌منزله عقد قرارداد قطعی نیست.<br><br>
          2. سقف اعتبار قابل ارائه <strong>۵۰ میلیون تومان</strong> و <strong>۱۰۰ میلیون تومان</strong> است. سقف ۱۰۰ میلیون تومان ویژه برخی مدل‌های منتخب (از جمله آیفون ۱۶ و ۱۷) می‌باشد.<br><br>
          3. مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت هزینه خدمات ثبت‌نام، استعلام اعتباری و تشکیل پرونده دریافت می‌شود. با توجه به انجام فرآیندهای اداری، این مبلغ
          <strong>در هیچ شرایطی (از جمله رد اعتبار یا انصراف متقاضی) قابل استرداد نمی‌باشد.</strong><br><br>
          4. <strong>نرخ خدمات مالی (سود ماهیانه) ۱.۹٪</strong> بوده و مبلغ اقساط بر این اساس محاسبه می‌گردد.<br><br>
          5. پس از تأیید اعتبار، مبلغ <strong>۱۱.۵٪ از کل اعتبار درخواستی</strong> تحت عنوان <strong>هزینه خدمات تسهیلاتی و مالی</strong> دریافت می‌شود. این مبلغ از اصل اعتبار کسر نمی‌گردد و پرداخت آن شرط ادامه روند قرارداد است.<br><br>
          6. برای عقد قرارداد، ارائه <strong>یک برگ چک صیادی بنفش به نام متقاضی</strong> الزامی است. ابتدا تصویر چک بررسی می‌شود و سپس اصل چک باید از طریق پست برای شرکت ارسال گردد.<br><br>
          7. مدت زمان تقریبی دریافت اصل چک توسط شرکت <strong>۳ تا ۵ روز کاری</strong> است. فعال‌سازی اعتبار پس از تحویل فیزیکی چک انجام می‌شود و در صورت وصول زودتر، مراحل سریع‌تر تکمیل می‌گردد.<br><br>
          8. <strong>نظر به نوسانات قیمت کالا، مبلغ نهایی خرید منوط به زمان تکمیل مراحل و ثبت قرارداد بوده و بر اساس نرخ روز محاسبه می‌گردد.</strong>
        </div>

        <label class="checkbox-row">
          <input type="checkbox" name="agree_fee" id="agree_fee" required>
          متعهد می‌شوم مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت استعلام و تشکیل پرونده را پرداخت نمایم و آگاه هستم که این مبلغ در هیچ شرایطی قابل استرداد نیست.
        </label>

        <label class="checkbox-row">
          <input type="checkbox" name="agree_info" id="agree_info" required>
          تأیید می‌کنم کلیه اطلاعات و مدارک ارائه‌شده صحیح و واقعی است و به واحد اعتباری میم‌استور اجازه استعلام لازم از مراجع مجاز را می‌دهم.
        </label>

        <label class="checkbox-row">
          <input type="checkbox" name="agree_terms" id="agree_terms" required>
          با مطالعه کامل شرایط فوق، نرخ خدمات مالی <strong>۱.۹٪</strong> و هزینه خدمات تسهیلاتی <strong>۱۱.۵٪</strong> را می‌پذیرم و می‌دانم ارسال این فرم صرفاً جهت بررسی اولیه می‌باشد.
        </label>

        <div class="signature-panel">
          <p style="margin-bottom:.4rem;">
            لطفاً امضاء الکترونیک خود را در کادر زیر وارد کنید. این امضاء به‌همراه شرایط و تیک‌ها در یک تصویر ذخیره می‌شود.
          </p>

          <canvas id="signature-pad" class="signature-canvas"></canvas>

          <div class="signature-actions">
            <button type="button" id="clear-signature">پاک کردن امضاء</button>
          </div>

          <p class="signature-name-line">
            نام و نام خانوادگی متقاضی:
            <strong><span id="sig-name-preview">........................</span></strong>
          </p>
        </div>
      </div>

      <!-- دکمه‌ها -->
      <div class="buttons">
        <button type="submit" class="btn-main">ارسال و ثبت در واتساپ میم‌استور</button>
        <button type="button" id="download-terms-png" class="btn-secondary">
          دانلود تصویر شرایط و امضاء (PNG)
        </button>
      </div>

      <p class="hint-text">
        برای تکمیل ثبت‌نام، پس از ارسال واتساپ، <strong>دانلود و ارسال تصویر شرایط و امضاء</strong> به‌صورت
        فایل (Document) در واتساپ الزامی است.
      </p>
    </form>
  </div>

  <!-- html2canvas برای ساخت PNG -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
          integrity="sha512-BNa5lK2nq2PpPAmhpN6wX+edE2l50Tzw9uQWGWpZJYG1ChcxrFAuo0xO+ogzAm8h1Hn0pVITwW2N9Q4vNKOu0w=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // --- سینک نام اصلی با خط امضاء ---
    const fullNameInput = document.getElementById('full-name');
    const sigNamePreview = document.getElementById('sig-name-preview');

    fullNameInput.addEventListener('input', function () {
      const v = this.value.trim();
      sigNamePreview.textContent = v || '........................';
    });

    // --- فرمت سه‌رقمی برای اعتبار موردنیاز ---
    const creditInput = document.getElementById('credit-needed');
    creditInput.addEventListener('input', function () {
      let val = this.value.replace(/,/g, '').replace(/[^0-9]/g, '');
      if (!val) {
        this.value = '';
        return;
      }
      this.value = val.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    });

    // --- امضاء الکترونیک (canvas) ---
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let signatureDrawn = false;

    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#000';
      ctx.clearRect(0, 0, rect.width, rect.height);
      signatureDrawn = false;
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      }
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    function startDraw(e) {
      e.preventDefault();
      drawing = true;
      const pos = getPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }

    function draw(e) {
      if (!drawing) return;
      e.preventDefault();
      const pos = getPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      signatureDrawn = true;
    }

    function endDraw(e) {
      if (!drawing) return;
      e && e.preventDefault();
      drawing = false;
    }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mouseleave', endDraw);

    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', endDraw, { passive: false });

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    document.getElementById('clear-signature').addEventListener('click', function (e) {
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);
      signatureDrawn = false;
    });

    // --- ارسال به واتساپ ---
    document.getElementById('mimstore-credit-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const data = new FormData(this);
      let msg = 'درخواست خرید اقساطی میم‌استور\n\n';

      msg += 'نام و نام خانوادگی: ' + (data.get('full_name') || '') + '\n';
      msg += 'نام پدر: ' + (data.get('father_name') || '') + '\n';
      msg += 'کد ملی: ' + (data.get('national_id') || '') + '\n';
      msg += 'شماره شناسنامه: ' + (data.get('id_number') || '') + '\n';
      msg += 'محل صدور شناسنامه: ' + (data.get('id_place') || '') + '\n';
      msg += 'تاریخ تولد: ' + (data.get('birth_date') || '') + '\n';
      msg += 'وضعیت تأهل: ' + (data.get('marital_status') || '') + '\n';
      msg += 'تحصیلات: ' + (data.get('education') || '') + '\n';
      msg += 'موبایل: ' + (data.get('mobile') || '') + '\n\n';

      msg += 'آدرس محل سکونت: ' + (data.get('address') || '') + '\n';
      msg += 'کد پستی: ' + (data.get('postal_code') || '') + '\n\n';

      msg += 'شغل: ' + (data.get('job_title') || '') + '\n';
      msg += 'سابقه کار (سال): ' + (data.get('job_years') || '') + '\n\n';

      msg += 'سقف اعتبار درخواستی: ' + (data.get('credit_cap') || '') + '\n';
      msg += 'اعتبار مورد نیاز: ' + (data.get('credit_needed') || '') + '\n';
      msg += 'مدل / توضیحات کالا: ' + (data.get('product_model') || '') + '\n';
      msg += 'توضیحات تکمیلی: ' + (data.get('extra_note') || '') + '\n\n';

      msg += '✅ کاربر سه بند زیر را پذیرفته است:\n';
      msg += '- پرداخت هزینه استعلام و تشکیل پرونده ۲۵۰٬۰۰۰ تومان\n';
      msg += '- صحت اطلاعات و اجازه استعلام از مراجع مجاز\n';
      msg += '- پذیرش نرخ خدمات مالی ۱.۹٪ و هزینه خدمات تسهیلاتی ۱۱.۵٪\n\n';

      msg += 'نام روی امضاء الکترونیک: ' + (data.get('full_name') || '') + '\n';
      msg += 'وضعیت امضاء در فرم: ' + (signatureDrawn ? 'ثبت شده ✅' : 'ثبت نشده ⚠️') + '\n\n';

      msg += 'یادآوری: لطفاً تصویر روی کارت ملی و تصویر شرایط + امضاء را به‌صورت Document ارسال کنید.';

      // شماره واتساپ میم‌استور: 09999926021 → بدون صفر + کد کشور
      const shopNumber = '989999926021';
      const waUrl = 'https://wa.me/' + shopNumber + '?text=' + encodeURIComponent(msg);

      window.open(waUrl, '_blank');
    });

    // --- دکمه دانلود PNG برای شرایط + تیک‌ها + امضاء ---
    document.getElementById('download-terms-png').addEventListener('click', function () {
      const fee = document.getElementById('agree_fee');
      const info = document.getElementById('agree_info');
      const terms = document.getElementById('agree_terms');

      if (!fee.checked || !info.checked || !terms.checked) {
        alert('لطفاً قبل از دانلود، هر سه تیک تأیید را بزنید.');
        return;
      }
      if (!signatureDrawn) {
        alert('لطفاً امضاء خود را در کادر امضاء وارد کنید، سپس تصویر را دانلود کنید.');
        return;
      }

      const confirmSection = document.getElementById('confirm-section');

      html2canvas(confirmSection, {
        scale: 3,
        useCORS: true,
        scrollY: -window.scrollY
      }).then(canvasResult => {
        const link = document.createElement('a');
        link.href = canvasResult.toDataURL('image/png', 1.0);
        link.download = 'mimstore-terms-signature.png';
        link.click();
      });
    });
  </script>
</body>
</html>
