<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>فرم درخواست خرید اقساطی – میم استور</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- فونت شبنم -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@v5.0.1/dist/font-face.css">

  <style>
    :root{
      --brand:#A40E1C;
      --wa:#25D366;
      --bg:#f5f5f5;
      --text:#222;
      --muted:#555;
      --border:#e6e6e6;
      --field:#d1d1d1;
      --card:#fff;
      --soft:#fafafa;
    }
    body{
      font-family:'Shabnam', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:var(--bg);
      margin:0;
      padding:1rem;
      color:var(--text);
    }
    .container{
      max-width:760px;
      margin:0 auto;
      background:var(--card);
      padding:1.25rem 1.25rem 1.75rem;
      border-radius:14px;
      box-shadow:0 8px 24px rgba(0,0,0,0.06);
      border:1px solid var(--border);
    }

    .logo-wrap{ text-align:center; margin-bottom:.5rem; }
    .logo-wrap img{ max-width:140px; height:auto; display:inline-block; }

    h2{
      text-align:center;
      margin:.25rem 0 .9rem;
      font-size:1.2rem;
      color:#1f1f1f;
    }
    h3{
      margin-top:1.6rem;
      border-right:4px solid var(--brand);
      padding-right:.6rem;
      font-size:1rem;
      color:#222;
    }
    p,label{ font-size:.9rem; color:#333; }
    input,select,textarea,button{ font-family:inherit; font-size:.9rem; line-height:1.4; }

    input[type="text"], input[type="tel"], input[type="number"], textarea, select{
      width:100%;
      box-sizing:border-box;
      padding:.5rem .6rem;
      margin-bottom:.55rem;
      border-radius:8px;
      border:1px solid var(--field);
      outline:none;
      background:#fcfcfc;
    }
    input:focus, textarea:focus, select:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 2px rgba(164,14,28,0.18);
      background:#fff;
    }
    textarea{ resize:vertical; min-height:70px; }

    .terms-box{
      border:1px solid #d6d6d6;
      border-radius:10px;
      padding:1rem;
      margin-bottom:.75rem;
      font-size:.85rem;
      line-height:1.9;
      text-align:justify;
      background:var(--soft);
    }

    .checkbox-row{
      display:block;
      margin-bottom:.5rem;
      font-size:.85rem;
      line-height:1.7;
    }
    .checkbox-row input{
      margin-left:.4rem;
      transform:scale(1.05);
    }

    /* امضاء */
    .signature-panel{
      border:1px dashed #bdbdbd;
      border-radius:10px;
      padding:.8rem .9rem 1rem;
      margin-top:.75rem;
      background:#fff;
      font-size:.85rem;
      line-height:1.8;
    }
    .signature-canvas{
      width:100%;
      height:170px;
      border:1px solid #b5b5b5;
      border-radius:8px;
      background:#fff;
      touch-action:none;
      display:block;
    }
    .signature-actions{
      margin-top:.4rem;
      text-align:left;
      font-size:.8rem;
    }
    .signature-actions button{
      padding:.3rem .75rem;
      border-radius:999px;
      border:none;
      background:#f44336;
      color:#fff;
      cursor:pointer;
    }
    .signature-actions button:hover{ background:#d32f2f; }
    .signature-name-line{ margin-top:.6rem; font-size:.85rem; }
    .signature-confirm{
      margin-top:.55rem;
      font-size:.83rem;
      color:#2e7d32;
      display:none;
    }

    .buttons{
      display:flex;
      flex-direction:column;
      gap:.65rem;
      margin-top:1.1rem;
    }
    .btn-main{
      width:100%;
      padding:.8rem;
      border-radius:999px;
      border:none;
      font-size:1rem;
      cursor:pointer;
      background:var(--wa);
      color:#fff;
      font-weight:600;
    }
    .btn-main:hover{ background:#1EB959; }

    .hint-text{
      margin-top:.7rem;
      font-size:.8rem;
      color:var(--muted);
      text-align:justify;
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:.5rem;
      margin:.25rem 0 1rem;
      background:#f2f2f2;
      padding:.5rem;
      border-radius:999px;
      border:1px solid #e2e2e2;
    }
    .tab-btn{
      flex:1;
      border:none;
      border-radius:999px;
      padding:.65rem .75rem;
      cursor:pointer;
      background:transparent;
      font-weight:700;
      color:#333;
    }
    .tab-btn.active{
      background:#fff;
      border:1px solid #e2e2e2;
      box-shadow:0 2px 10px rgba(0,0,0,0.05);
      color:#111;
    }
    .form-panel{ display:none; }
    .form-panel.active{ display:block; }

    .mini-note{
      font-size:.82rem;
      color:#444;
      background:#fff7f7;
      border:1px solid #ffd6d6;
      padding:.6rem .75rem;
      border-radius:10px;
      line-height:1.8;
      margin:.75rem 0 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="logo-wrap">
      <!-- این فایل لوگو باید در ریشه پروژه باشد: logo-mimstore.png -->
      <img src="logo-mimstore.png" alt="میم استور">
    </div>

    <h2>فرم درخواست خرید اقساطی – میم استور</h2>

    <!-- سوییچ -->
    <div class="tabs" role="tablist" aria-label="انتخاب نوع اقساط">
      <button type="button" id="tab-company" class="tab-btn active">اقساط شرکتی</button>
      <button type="button" id="tab-store" class="tab-btn">اقساط فروشگاهی</button>
    </div>

    <!-- ====================== فرم شرکتی ====================== -->
    <div id="panel-company" class="form-panel active">
      <form id="mimstore-credit-form-company">
        <p style="text-align:justify; line-height:1.7;">
          لطفاً این فرم را تنها توسط متقاضی اصلی خرید اقساطی تکمیل کنید. تمامی اطلاعات، از جمله چک و مدارک اعتباری،
          باید به نام همان متقاضی (دارنده دسته‌چک) باشد. در صورت مغایرت، بررسی درخواست انجام نخواهد شد.
        </p>

        <!-- ۱. اطلاعات هویتی متقاضی -->
        <h3>۱. اطلاعات هویتی متقاضی</h3>

        <label>نام و نام خانوادگی</label>
        <input type="text" name="full_name" id="full-name-company" required placeholder="مثال: علی رضایی">

        <label>نام پدر</label>
        <input type="text" name="father_name" required placeholder="مثال: حسن">

        <label>کد ملی</label>
        <input type="text" name="national_id" required minlength="10" maxlength="10" placeholder="۱۰ رقم">

        <label>شماره شناسنامه</label>
        <input type="text" name="id_number" required placeholder="مثال: 12345">

        <label>محل صدور شناسنامه</label>
        <input type="text" name="id_place" required placeholder="مثال: تهران">

        <label>تاریخ تولد (شمسی)</label>
        <input type="text" name="birth_date" required placeholder="مثال: 1378/05/21">

        <label>وضعیت تأهل</label>
        <select name="marital_status" required>
          <option value="">انتخاب کنید</option>
          <option value="مجرد">مجرد</option>
          <option value="متأهل">متأهل</option>
        </select>

        <label>میزان تحصیلات</label>
        <select name="education" required>
          <option value="">انتخاب کنید</option>
          <option value="دیپلم">دیپلم</option>
          <option value="کاردانی">کاردانی</option>
          <option value="کارشناسی">کارشناسی</option>
          <option value="کارشناسی ارشد">کارشناسی ارشد</option>
          <option value="دکتری">دکتری</option>
        </select>

        <label>شماره موبایل به نام خودتان</label>
        <input type="tel" name="mobile" required placeholder="مثال: 09XXXXXXXXX">

        <!-- ۲. اطلاعات محل سکونت -->
        <h3>۲. اطلاعات محل سکونت</h3>

        <label>نشانی کامل محل سکونت</label>
        <textarea name="address" required placeholder="شهر، خیابان، کوچه، پلاک، واحد"></textarea>

        <label>کد پستی</label>
        <input type="text" name="postal_code" required minlength="10" maxlength="10" placeholder="مثال: 1234567890">

        <!-- اضافه شده: مالک/مستأجر -->
        <label>وضعیت سکونت</label>
        <select name="housing_status" required>
          <option value="">انتخاب کنید</option>
          <option value="مالک">مالک</option>
          <option value="مستأجر">مستأجر</option>
        </select>

        <!-- ۳. اطلاعات شغلی -->
        <h3>۳. اطلاعات شغلی</h3>

        <label>شغل / عنوان شغلی</label>
        <input type="text" name="job_title" required placeholder="مثال: فروشنده موبایل">

        <label>سابقه کار (چند سال)</label>
        <input type="number" name="job_years" min="0" required placeholder="مثال: ۳">

        <!-- ۴. اطلاعات اعتبار درخواستی -->
        <h3>۴. اطلاعات اعتبار درخواستی</h3>

        <p style="margin-bottom:.4rem;">سقف اعتبار درخواستی</p>
        <label class="checkbox-row">
          <input type="radio" name="credit_cap" value="۵۰ میلیون تومان" required>
          ۵۰ میلیون تومان
        </label>
        <label class="checkbox-row" style="margin-bottom:.6rem;">
          <input type="radio" name="credit_cap" value="۱۰۰ میلیون تومان (آیفون ۱۶ و ۱۷)">
          ۱۰۰ میلیون تومان (فقط برای خرید آیفون ۱۶ و ۱۷)
        </label>

        <label>اعتبار مورد نیاز (در صورت کمتر بودن)</label>
        <input type="text" id="credit-needed-company" name="credit_needed" placeholder="مثال: 50,000,000">

        <label>مدل کالا / توضیحات خرید</label>
        <input type="text" name="product_model" placeholder="مثال: iPhone 13 ، Samsung S24">

        <label>توضیحات تکمیلی (اختیاری)</label>
        <textarea name="extra_note" placeholder="هر توضیحی لازم است بنویسید"></textarea>

        <!-- ۵. مدارک -->
        <h3>۵. مدارک</h3>

        <p style="font-size:.9rem; line-height:1.7; text-align:justify;">
          پس از ارسال این فرم، <strong>ارسال تصویر واضح روی کارت ملی از طریق واتساپ به شماره میم‌استور الزامی است.</strong><br>
          بدون دریافت تصویر کارت ملی، امکان ادامه روند اعتبارسنجی وجود نخواهد داشت.
        </p>

        <!-- ۶. شرایط + تیک‌ها + امضاء -->
        <h3>۶. شرایط و مقررات و تأیید متقاضی</h3>

        <div id="confirm-section-company">
          <div class="terms-box">
            1. این فرم صرفاً جهت <strong>بررسی اولیه اعتبار</strong> می‌باشد و به‌تنهایی به‌منزله عقد قرارداد قطعی نیست.<br><br>
            2. سقف اعتبار قابل ارائه <strong>۵۰ میلیون تومان</strong> و <strong>۱۰۰ میلیون تومان</strong> است. سقف ۱۰۰ میلیون تومان ویژه برخی مدل‌های منتخب (از جمله آیفون ۱۶ و ۱۷) می‌باشد.<br><br>
            3. مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت هزینه خدمات ثبت‌نام، استعلام اعتباری و تشکیل پرونده دریافت می‌شود. با توجه به انجام فرآیندهای اداری، این مبلغ
            <strong>در هیچ شرایطی (از جمله رد اعتبار یا انصراف متقاضی) قابل استرداد نمی‌باشد.</strong><br><br>
            3.1. درخواست اعتبارسنجی مجدد تنها درصورتی بررسی می‌شود که متقاضی اطلاعات جدید، معتبر و قابل استناد ارائه نماید.
            در غیر این‌صورت، امکان انجام اعتبارسنجی مجدد وجود نخواهد داشت.<br><br>
            4. <strong>نرخ خدمات مالی (سود ماهیانه) ۱.۹٪</strong> بوده و مبلغ اقساط بر این اساس محاسبه می‌گردد.<br><br>
            5. پس از تأیید اعتبار، مبلغ <strong>۱۱.۵٪ از کل اعتبار درخواستی</strong> تحت عنوان <strong>هزینه خدمات تسهیلاتی و مالی</strong> دریافت می‌شود. این مبلغ از اصل اعتبار کسر نمی‌گردد و پرداخت آن شرط ادامه روند قرارداد است.<br><br>
            6. برای عقد قرارداد، ارائه <strong>یک برگ چک صیادی بنفش به نام متقاضی</strong> الزامی است. ابتدا تصویر چک بررسی می‌شود و سپس اصل چک باید از طریق پست برای شرکت ارسال گردد.<br><br>
            7. مدت زمان تقریبی دریافت اصل چک توسط شرکت <strong>۳ تا ۵ روز کاری</strong> است. فعال‌سازی اعتبار پس از تحویل فیزیکی چک انجام می‌شود و در صورت وصول زودتر، مراحل سریع‌تر تکمیل می‌گردد.<br><br>
            8. <strong>نظر به نوسانات قیمت کالا، مبلغ نهایی خرید منوط به زمان تکمیل مراحل و ثبت قرارداد بوده و بر اساس نرخ روز محاسبه می‌گردد.</strong>
          </div>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_fee" id="agree_fee_company" required>
            متعهد می‌شوم مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت استعلام و تشکیل پرونده را پرداخت نمایم و آگاه هستم که این مبلغ در هیچ شرایطی قابل استرداد نیست.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_info" id="agree_info_company" required>
            تأیید می‌کنم کلیه اطلاعات و مدارک ارائه‌شده صحیح و واقعی است و به واحد اعتباری میم‌استور اجازه استعلام لازم از مراجع مجاز را می‌دهم.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_terms" id="agree_terms_company" required>
            با مطالعه کامل شرایط فوق، نرخ خدمات مالی <strong>۱.۹٪</strong> و هزینه خدمات تسهیلاتی <strong>۱۱.۵٪</strong> را می‌پذیرم و می‌دانم ارسال این فرم صرفاً جهت بررسی اولیه می‌باشد.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_no_password_change" id="agree_no_password_change_company" required>
            متعهد می‌شوم تا پایان مراحل بررسی، ثبت پرونده و پیگیری اعتبارسنجی، رمز ورود و دسترسی حساب مرتبط با این پرونده را تغییر ندهم.
            در صورت تغییر رمز یا ایجاد محدودیت دسترسی برای فروشگاه، این اقدام به منزله <strong>انصراف از خرید اقساطی</strong> ثبت می‌شود.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_send_check" id="agree_send_check_company" required>
            هزینه ارسال چک و هزینه‌های پستی به‌عهده متقاضی است.
          </label>

          <div class="signature-panel">
            <p style="margin-bottom:.4rem;">لطفاً امضاء الکترونیک خود را در کادر زیر وارد کنید.</p>

            <canvas id="signature-pad-company" class="signature-canvas"></canvas>

            <div class="signature-actions">
              <button type="button" id="clear-signature-company">پاک کردن امضاء</button>
            </div>

            <div class="signature-name-line">
              <label>نام و نام خانوادگی جهت امضاء</label>
              <input type="text" id="signature-name-company" name="signature_name" placeholder="عیناً مطابق شناسنامه" required>
            </div>

            <p id="signature-confirm-company" class="signature-confirm"></p>
          </div>
        </div>

        <div class="buttons">
          <button type="submit" class="btn-main">ارسال و ثبت در واتساپ میم‌استور</button>
        </div>

        <p class="hint-text">
          پس از ارسال فرم در واتساپ، لطفاً <strong>تصویر روی کارت ملی</strong> خود را نیز ارسال کنید و تا پایان بررسی پرونده از
          <strong>تغییر رمز ورود حساب مربوطه خودداری نمایید.</strong>
        </p>
      </form>
    </div>

    <!-- ====================== فرم فروشگاهی ====================== -->
    <div id="panel-store" class="form-panel">
      <form id="mimstore-credit-form-store">
        <p style="text-align:justify; line-height:1.7;">
          لطفاً این فرم را تنها توسط متقاضی اصلی تکمیل کنید. اطلاعات صرفاً جهت بررسی و تنظیم شرایط فروش اقساطی فروشگاهی استفاده می‌شود.
        </p>

        <h3>۱. اطلاعات هویتی متقاضی</h3>

        <label>نام و نام خانوادگی</label>
        <input type="text" name="full_name" id="full-name-store" required placeholder="مثال: علی رضایی">

        <label>نام پدر</label>
        <input type="text" name="father_name" required placeholder="مثال: حسن">

        <label>کد ملی</label>
        <input type="text" name="national_id" required minlength="10" maxlength="10" placeholder="۱۰ رقم">

        <label>تاریخ تولد (شمسی)</label>
        <input type="text" name="birth_date" required placeholder="مثال: 1378/05/21">

        <label>شماره موبایل به نام خودتان</label>
        <input type="tel" name="mobile" required placeholder="مثال: 09XXXXXXXXX">

        <h3>۲. اطلاعات محل سکونت</h3>

        <label>نشانی کامل محل سکونت</label>
        <textarea name="address" required placeholder="شهر، خیابان، کوچه، پلاک، واحد"></textarea>

        <label>کد پستی</label>
        <input type="text" name="postal_code" required minlength="10" maxlength="10" placeholder="مثال: 1234567890">

        <!-- اضافه شده: مالک/مستأجر -->
        <label>وضعیت سکونت</label>
        <select name="housing_status" required>
          <option value="">انتخاب کنید</option>
          <option value="مالک">مالک</option>
          <option value="مستأجر">مستأجر</option>
        </select>

        <h3>۳. اطلاعات شغلی</h3>

        <label>شغل / عنوان شغلی</label>
        <input type="text" name="job_title" required placeholder="مثال: فروشنده موبایل">

        <label>سابقه کار (چند سال)</label>
        <input type="number" name="job_years" min="0" required placeholder="مثال: ۳">

        <h3>۴. اطلاعات خرید و شرایط فروشگاهی</h3>

        <label>مدل کالا / توضیحات خرید</label>
        <input type="text" name="product_model" placeholder="مثال: iPhone 13 ، Samsung S24" required>

        <label>پیش‌پرداخت قابل پرداخت</label>
        <input type="text" id="down-payment-store" name="down_payment" placeholder="مثال: 10,000,000" required>

        <p style="margin-bottom:.4rem;">دوره بازپرداخت</p>
        <label class="checkbox-row">
          <input type="radio" name="installment_plan" value="۶ ماهه" required>
          ۶ ماهه
        </label>
        <label class="checkbox-row" style="margin-bottom:.6rem;">
          <input type="radio" name="installment_plan" value="درخواست بررسی ۱۲ ماهه">
          درخواست بررسی ۱۲ ماهه
        </label>

        <p style="margin-bottom:.4rem;">نوع ضمانت (یکی را انتخاب کنید)</p>
        <label class="checkbox-row">
          <input type="radio" name="guarantee_type" value="چک" required>
          چک
        </label>
        <label class="checkbox-row">
          <input type="radio" name="guarantee_type" value="چک کارمندی">
          چک کارمندی
        </label>
        <label class="checkbox-row" style="margin-bottom:.8rem;">
          <input type="radio" name="guarantee_type" value="طلا">
          طلا
        </label>

        <label>توضیحات تکمیلی (اختیاری)</label>
        <textarea name="extra_note" placeholder="هر توضیحی لازم است بنویسید"></textarea>

        <h3>۵. مدارک</h3>
        <p style="font-size:.9rem; line-height:1.7; text-align:justify;">
          پس از ارسال فرم، <strong>ارسال تصویر واضح روی کارت ملی از طریق واتساپ الزامی است.</strong>
        </p>

        <h3>۶. شرایط و مقررات و تأیید متقاضی</h3>

        <div id="confirm-section-store">
          <div class="terms-box">
            1. این فرم صرفاً جهت <strong>ثبت درخواست و بررسی اولیه</strong> بوده و به‌منزله عقد قرارداد قطعی نیست.<br><br>
            2. مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت هزینه خدمات ثبت‌نام، استعلام و تشکیل پرونده دریافت می‌شود و
            <strong>در هیچ شرایطی قابل استرداد نمی‌باشد.</strong><br><br>
            3.1. درخواست اعتبارسنجی مجدد تنها درصورتی بررسی می‌شود که متقاضی اطلاعات جدید، معتبر و قابل استناد ارائه نماید.
            در غیر این‌صورت، امکان انجام اعتبارسنجی مجدد وجود نخواهد داشت.
          </div>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_fee" id="agree_fee_store" required>
            متعهد می‌شوم مبلغ <strong>۲۵۰٬۰۰۰ تومان</strong> بابت استعلام و تشکیل پرونده را پرداخت نمایم و آگاه هستم که این مبلغ در هیچ شرایطی قابل استرداد نیست.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_info" id="agree_info_store" required>
            تأیید می‌کنم کلیه اطلاعات ارائه‌شده صحیح و واقعی است و اجازه بررسی/استعلام لازم از مراجع مجاز را می‌دهم.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_no_password_change" id="agree_no_password_change_store" required>
            متعهد می‌شوم تا پایان مراحل بررسی و پیگیری، رمز ورود و دسترسی حساب مرتبط را تغییر ندهم؛
            در صورت تغییر، درخواست به منزله <strong>انصراف</strong> ثبت می‌شود.
          </label>

          <label class="checkbox-row">
            <input type="checkbox" name="agree_send_check" id="agree_send_check_store" required>
            هزینه ارسال چک و هزینه‌های پستی به‌عهده متقاضی است.
          </label>

          <div class="signature-panel">
            <p style="margin-bottom:.4rem;">لطفاً امضاء الکترونیک خود را در کادر زیر وارد کنید.</p>

            <canvas id="signature-pad-store" class="signature-canvas"></canvas>

            <div class="signature-actions">
              <button type="button" id="clear-signature-store">پاک کردن امضاء</button>
            </div>

            <div class="signature-name-line">
              <label>نام و نام خانوادگی جهت امضاء</label>
              <input type="text" id="signature-name-store" name="signature_name" placeholder="عیناً مطابق شناسنامه" required>
            </div>

            <p id="signature-confirm-store" class="signature-confirm"></p>
          </div>

          <div class="mini-note">
            نکته: انتخاب «درخواست بررسی ۱۲ ماهه» به معنی <b>درخواست بررسی</b> است و نتیجه نهایی پس از بررسی اعلام می‌گردد.
          </div>
        </div>

        <div class="buttons">
          <button type="submit" class="btn-main">ارسال و ثبت در واتساپ میم‌استور</button>
        </div>

        <p class="hint-text">
          پس از ارسال فرم در واتساپ، لطفاً <strong>تصویر روی کارت ملی</strong> خود را نیز ارسال کنید.
        </p>
      </form>
    </div>
  </div>

  <script>
    // ---------- Tabs ----------
    const tabCompany = document.getElementById('tab-company');
    const tabStore   = document.getElementById('tab-store');
    const panelCompany = document.getElementById('panel-company');
    const panelStore   = document.getElementById('panel-store');

    function activate(which){
      const isCompany = which === 'company';
      tabCompany.classList.toggle('active', isCompany);
      tabStore.classList.toggle('active', !isCompany);
      panelCompany.classList.toggle('active', isCompany);
      panelStore.classList.toggle('active', !isCompany);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    tabCompany.addEventListener('click', () => activate('company'));
    tabStore.addEventListener('click', () => activate('store'));

    // ---------- Helpers ----------
    function addThousandsFormatter(inputId){
      const el = document.getElementById(inputId);
      if(!el) return;
      el.addEventListener('input', function(){
        let val = this.value.replace(/,/g,'').replace(/[^0-9]/g,'');
        if(!val){ this.value=''; return; }
        this.value = val.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      });
    }

    addThousandsFormatter('credit-needed-company');
    addThousandsFormatter('down-payment-store');

    // ---------- Signature pad (Reusable) ----------
    function initSignaturePad(opts){
      const canvas = document.getElementById(opts.canvasId);
      const ctx = canvas.getContext('2d');
      const clearBtn = document.getElementById(opts.clearBtnId);
      const fullNameInput = document.getElementById(opts.fullNameId);
      const sigNameInput  = document.getElementById(opts.sigNameId);
      const sigConfirm    = document.getElementById(opts.confirmId);

      let drawing = false;
      let signatureDrawn = false;

      function updateSignatureConfirmText(){
        const nameForSig =
          (sigNameInput.value && sigNameInput.value.trim()) ||
          (fullNameInput.value && fullNameInput.value.trim()) ||
          '';

        if(!nameForSig){
          sigConfirm.textContent = '';
          sigConfirm.style.display = 'none';
          return;
        }

        sigConfirm.textContent =
          '✔ امضاء الکترونیک اینجانب «' + nameForSig + '» با پذیرش تمامی شرایط و قوانین فوق ثبت گردید.';
        sigConfirm.style.display = 'block';
      }

      fullNameInput.addEventListener('input', function(){
        if(!sigNameInput.value.trim()){
          sigNameInput.value = this.value;
        }
        updateSignatureConfirmText();
      });

      sigNameInput.addEventListener('input', updateSignatureConfirmText);

      function resizeCanvas(){
        const ratio = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * ratio;
        canvas.height = rect.height * ratio;
        ctx.setTransform(ratio,0,0,ratio,0,0);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
        ctx.clearRect(0,0,rect.width,rect.height);
        signatureDrawn = false;
        sigConfirm.style.display = 'none';
      }

      function getPos(e){
        const rect = canvas.getBoundingClientRect();
        if(e.touches && e.touches[0]){
          return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
        }
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }

      function startDraw(e){
        e.preventDefault();
        drawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x,pos.y);
      }

      function draw(e){
        if(!drawing) return;
        e.preventDefault();
        const pos = getPos(e);
        ctx.lineTo(pos.x,pos.y);
        ctx.stroke();
        signatureDrawn = true;
        if(!sigConfirm.textContent.trim()) updateSignatureConfirmText();
        sigConfirm.style.display = 'block';
      }

      function endDraw(e){
        if(!drawing) return;
        e && e.preventDefault();
        drawing = false;
      }

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', endDraw);
      canvas.addEventListener('mouseleave', endDraw);

      canvas.addEventListener('touchstart', startDraw, { passive:false });
      canvas.addEventListener('touchmove', draw, { passive:false });
      canvas.addEventListener('touchend', endDraw, { passive:false });

      window.addEventListener('resize', resizeCanvas);
      resizeCanvas();

      clearBtn.addEventListener('click', function(e){
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0,0,rect.width,rect.height);
        signatureDrawn = false;
        sigConfirm.style.display = 'none';
      });

      return {
        isSigned: () => signatureDrawn,
        getSignerName: () => (sigNameInput.value || '')
      };
    }

    const sigCompany = initSignaturePad({
      canvasId:'signature-pad-company',
      clearBtnId:'clear-signature-company',
      confirmId:'signature-confirm-company',
      fullNameId:'full-name-company',
      sigNameId:'signature-name-company'
    });

    const sigStore = initSignaturePad({
      canvasId:'signature-pad-store',
      clearBtnId:'clear-signature-store',
      confirmId:'signature-confirm-store',
      fullNameId:'full-name-store',
      sigNameId:'signature-name-store'
    });

    // ---------- WhatsApp ----------
    const shopNumber = '989999926021'; // 09999926021

    function openWhatsApp(msg){
      const waUrl = 'https://wa.me/' + shopNumber + '?text=' + encodeURIComponent(msg);
      window.open(waUrl, '_blank');
    }

    // فرم شرکتی
    document.getElementById('mimstore-credit-form-company').addEventListener('submit', function(e){
      e.preventDefault();

      if(!sigCompany.isSigned()){
        alert('لطفاً امضاء الکترونیک را ثبت کنید.');
        return;
      }

      const data = new FormData(this);
      let msg = 'درخواست خرید اقساطی میم‌استور (شرکتی)\n\n';

      msg += 'نام و نام خانوادگی: ' + (data.get('full_name') || '') + '\n';
      msg += 'نام پدر: ' + (data.get('father_name') || '') + '\n';
      msg += 'کد ملی: ' + (data.get('national_id') || '') + '\n';
      msg += 'شماره شناسنامه: ' + (data.get('id_number') || '') + '\n';
      msg += 'محل صدور شناسنامه: ' + (data.get('id_place') || '') + '\n';
      msg += 'تاریخ تولد: ' + (data.get('birth_date') || '') + '\n';
      msg += 'وضعیت تأهل: ' + (data.get('marital_status') || '') + '\n';
      msg += 'تحصیلات: ' + (data.get('education') || '') + '\n';
      msg += 'موبایل: ' + (data.get('mobile') || '') + '\n\n';

      msg += 'آدرس محل سکونت: ' + (data.get('address') || '') + '\n';
      msg += 'کد پستی: ' + (data.get('postal_code') || '') + '\n';
      msg += 'وضعیت سکونت: ' + (data.get('housing_status') || '') + '\n\n';

      msg += 'شغل: ' + (data.get('job_title') || '') + '\n';
      msg += 'سابقه کار (سال): ' + (data.get('job_years') || '') + '\n\n';

      msg += 'سقف اعتبار درخواستی: ' + (data.get('credit_cap') || '') + '\n';
      msg += 'اعتبار مورد نیاز: ' + (data.get('credit_needed') || '') + '\n';
      msg += 'مدل / توضیحات کالا: ' + (data.get('product_model') || '') + '\n';
      msg += 'توضیحات تکمیلی: ' + (data.get('extra_note') || '') + '\n\n';

      msg += '✅ کاربر بندهای زیر را پذیرفته است:\n';
      msg += '- پرداخت هزینه استعلام و تشکیل پرونده ۲۵۰٬۰۰۰ تومان\n';
      msg += '- درخواست اعتبارسنجی مجدد تنها با اطلاعات جدید و معتبر بررسی می‌شود\n';
      msg += '- صحت اطلاعات و اجازه استعلام از مراجع مجاز\n';
      msg += '- پذیرش نرخ خدمات مالی ۱.۹٪ و هزینه خدمات تسهیلاتی ۱۱.۵٪\n';
      msg += '- تعهد به عدم تغییر رمز عبور و دسترسی حساب تا پایان مراحل بررسی (در صورت تغییر، انصراف محسوب می‌شود)\n';
      msg += '- هزینه ارسال چک و هزینه‌های پستی به‌عهده متقاضی است\n\n';

      msg += 'نام جهت امضاء: ' + (data.get('signature_name') || '') + '\n';
      msg += 'وضعیت امضاء در فرم: ثبت شده ✅\n\n';

      msg += 'یادآوری: لطفاً تصویر روی کارت ملی را ارسال کنید.';

      openWhatsApp(msg);
    });

    // فرم فروشگاهی
    document.getElementById('mimstore-credit-form-store').addEventListener('submit', function(e){
      e.preventDefault();

      if(!sigStore.isSigned()){
        alert('لطفاً امضاء الکترونیک را ثبت کنید.');
        return;
      }

      const data = new FormData(this);
      let msg = 'درخواست خرید اقساطی میم‌استور (فروشگاهی)\n\n';

      msg += 'نام و نام خانوادگی: ' + (data.get('full_name') || '') + '\n';
      msg += 'نام پدر: ' + (data.get('father_name') || '') + '\n';
      msg += 'کد ملی: ' + (data.get('national_id') || '') + '\n';
      msg += 'تاریخ تولد: ' + (data.get('birth_date') || '') + '\n';
      msg += 'موبایل: ' + (data.get('mobile') || '') + '\n\n';

      msg += 'آدرس محل سکونت: ' + (data.get('address') || '') + '\n';
      msg += 'کد پستی: ' + (data.get('postal_code') || '') + '\n';
      msg += 'وضعیت سکونت: ' + (data.get('housing_status') || '') + '\n\n';

      msg += 'شغل: ' + (data.get('job_title') || '') + '\n';
      msg += 'سابقه کار (سال): ' + (data.get('job_years') || '') + '\n\n';

      msg += 'مدل / توضیحات کالا: ' + (data.get('product_model') || '') + '\n';
      msg += 'پیش‌پرداخت قابل پرداخت: ' + (data.get('down_payment') || '') + '\n';
      msg += 'دوره بازپرداخت: ' + (data.get('installment_plan') || '') + '\n';
      msg += 'نوع ضمانت: ' + (data.get('guarantee_type') || '') + '\n';
      msg += 'توضیحات تکمیلی: ' + (data.get('extra_note') || '') + '\n\n';

      msg += '✅ کاربر بندهای زیر را پذیرفته است:\n';
      msg += '- پرداخت هزینه استعلام و تشکیل پرونده ۲۵۰٬۰۰۰ تومان\n';
      msg += '- درخواست اعتبارسنجی مجدد تنها با اطلاعات جدید و معتبر بررسی می‌شود\n';
      msg += '- صحت اطلاعات و اجازه بررسی/استعلام از مراجع مجاز\n';
      msg += '- تعهد به عدم تغییر رمز عبور و دسترسی حساب تا پایان مراحل بررسی (در صورت تغییر، انصراف محسوب می‌شود)\n';
      msg += '- هزینه ارسال چک و هزینه‌های پستی به‌عهده متقاضی است\n\n';

      msg += 'نام جهت امضاء: ' + (data.get('signature_name') || '') + '\n';
      msg += 'وضعیت امضاء در فرم: ثبت شده ✅\n\n';

      msg += 'یادآوری: لطفاً تصویر روی کارت ملی را ارسال کنید.';

      openWhatsApp(msg);
    });
  </script>
</body>
</html>